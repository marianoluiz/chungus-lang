"""
Transition Diagram (TD) state table.

- State is a lightweight structure that stores:
    - chars: set/list of characters accepted in this state
    - branches: list of next-state indices (transitions)
    - isEnd: boolean indicating whether the state is an accepting/terminal one

- STATES is a mapping from integer state id -> State
  It encodes the DFA used by `lexer.lexemize()`.

Note:
- This file is dense because it encodes the entire TD as a table. When migrating to a
  new language, update this table to reflect your new grammar/token classes.
"""
# Assuming atoms.py and delimiters.py are in a 'constants' folder or similar
# If they are in the same directory, you might use:
# from .atoms import ATOMS
# from .delimiters import DELIMS
# But I will follow your example's import path:
from constants import ATOMS, DELIMS

class State:
    def __init__(self, chars: list[str], branches: list[int] = [], end = False):
        self.chars = [chars] if type(chars) is str else chars
        self.branches = [branches] if type(branches) is int else branches
        self.isEnd = end

STATES = {
    0: State('initial', [1, 27, 31, 43, 62, 69, 73, 76, 88, 99, 112, 118, 
                        122, 126, 130, 132, 136, 140, 144, 148, 152, 154, 156, 
                        158, 160, 162, 170, 172, 173, 224]),
    1: State('a', [2, 8, 11]),
    2: State('l', [3]),
    3: State('w', [4]),
    4: State('a', [5]),
    5: State('y', [6]),
    6: State('s', [7]),
    7: State(DELIMS['inline_delim'], end=True),
    8: State('n', [9]),
    9: State('d', [10]),
    10: State(DELIMS['inline_delim'], end=True),
    11: State('r', [12]),
    12: State('r', [13]),
    13: State('a', [14]),
    14: State('y', [15, 20]),
    15: State('_', [16]),
    16: State('a', [17]),
    17: State('d', [18]),
    18: State('d', [19]),
    19: State(DELIMS['method_delim'], end=True),
    20: State('r', [21]),
    21: State('e', [22]),
    22: State('m', [23]),
    23: State('o', [24]),
    24: State('v', [25]),
    25: State('e', [26]),
    26: State(DELIMS['method_delim'], end=True),
    27: State('c', [28]),
    28: State('l', [29]),
    29: State('r', [30]),
    30: State(DELIMS['stmt_delim'], end=True),
    31: State('e', [32, 39]),
    32: State('l', [33]),
    33: State('i', [34]),
    34: State('f', [35]),
    35: State(DELIMS['inline_delim'], end=True),
    36: State('s', [37]),
    37: State('e', [38]),
    38: State(DELIMS['stmt_delim'], end=True),
    39: State('x', [40]),
    40: State('i', [41]),
    41: State('t', [42]),
    42: State(DELIMS['stmt_delim'], end=True),
    43: State('f', [44, 52, 57, 59]),
    44: State('a', [45, 49]),
    45: State('l', [46]),
    46: State('s', [47]),
    47: State('e', [48]),
    48: State(DELIMS['dtype_lit_delim'], end=True),
    49: State('i', [50]),
    50: State('l', [51]),
    51: State(DELIMS['stmt_delim'], end=True),
    52: State('l', [53]),
    53: State('o', [54]),
    54: State('a', [55]),
    55: State('t', [56]),
    56: State(DELIMS['method_delim'], end=True),
    57: State('n', [58]),
    58: State(DELIMS['inline_delim'], end=True),
    59: State('o', [60]),
    60: State('r', [61]),
    61: State(DELIMS['inline_delim'], end=True),
    62: State('i', [63, 65]),
    63: State('f', [64]),
    64: State(DELIMS['inline_delim'], end=True),
    65: State('n', [66, 67]),
    66: State(DELIMS['inline_delim'], end=True),
    67: State('t', [68]),
    68: State(DELIMS['method_delim'], end=True),

    69: State('n', [70]),
    70: State('i', [71]),
    71: State('l', [72]),
    72: State(DELIMS['dtype_lit_delim'], end=True),
    73: State('o', [74]),
    74: State('r', [75]),
    75: State(DELIMS['inline_delim'], end=True),
    76: State('r', [77, 82]),
    77: State('a', [78]),
    78: State('n', [79]),
    79: State('g', [80]),
    80: State('e', [81]),
    81: State(DELIMS['method_delim'], end=True),
    82: State('e', [83, 86]),
    83: State('a', [84]),
    84: State('d', [85]),
    85: State(DELIMS['stmt_delim'], end=True),
    86: State('t', [87]),
    87: State(DELIMS['inline_delim'], end=True),
    88: State('t', [89, 93]),
    89: State('o', [90]),
    90: State('d', [91]),
    91: State('o', [92]),
    92: State(DELIMS['stmt_delim'], end=True),
    93: State('r', [94, 97]),
    94: State('u', [95]),
    95: State('e', [96]),
    96: State(DELIMS['dtype_lit_delim'], end=True),
    97: State('y', [98]),
    98: State(DELIMS['stmt_delim'], end=True),
    99: State('s', [100, 104, 108]),
    100: State('h', [101]),
    101: State('o', [102]),
    102: State('w', [103]),
    103: State(DELIMS['inline_delim'], end=True),
    104: State('k', [105]),
    105: State('i', [106]),
    106: State('p', [107]),
    107: State(DELIMS['stmt_delim'], end=True),
    108: State('t', [109]),
    109: State('o', [110]),
    110: State('p', [111]),
    111: State(DELIMS['stmt_delim'], end=True),
    112: State('w', [113]),
    113: State('h', [114]),
    114: State('i', [115]),
    115: State('l', [116]),
    116: State('e', [117]),
    117: State(DELIMS['inline_delim'], end=True),

    118: State('+', [119, 120]),
    119: State(DELIMS['arith_rel_not_op_delim'], end=True),
    120: State('+', [121]),
    121: State(DELIMS['stmt_delim'], end=True),
    122: State('-', [123, 124]),
    123: State(DELIMS['arith_rel_not_op_delim'], end=True),
    124: State('-', [125]),
    125: State(DELIMS['stmt_delim'], end=True),
    126: State('*', [127, 128]),
    127: State(DELIMS['arith_rel_not_op_delim'], end=True),
    128: State('*', [129]),
    129: State(DELIMS['arith_rel_not_op_delim'], end=True),
    130: State('%', [131]),
    131: State(DELIMS['arith_rel_not_op_delim'], end=True),
    132: State('/', [133, 134]),
    133: State(DELIMS['arith_rel_not_op_delim'], end=True),
    134: State('/', [135]),
    135: State(DELIMS['arith_rel_not_op_delim'], end=True),

    136: State('=', [137, 138]),
    137: State(DELIMS['assign_op_delim'], end=True),
    138: State('=', [139]),
    139: State(DELIMS['arith_rel_not_op_delim'], end=True),
    140: State('!', [141, 142]),
    141: State(DELIMS['arith_rel_not_op_delim'], end=True),
    142: State('=', [143]),
    143: State(DELIMS['arith_rel_not_op_delim'], end=True),
    144: State('<', [145, 146]),
    145: State(DELIMS['arith_rel_not_op_delim'], end=True),
    146: State('=', [147]),
    147: State(DELIMS['arith_rel_not_op_delim'], end=True),
    148: State('>', [149, 150]),
    149: State(DELIMS['arith_rel_not_op_delim'], end=True),
    150: State('=', [151]),
    151: State(DELIMS['arith_rel_not_op_delim'], end=True),

    152: State('(', [153]),
    153: State(DELIMS['paren_open_delim'], end=True),
    154: State(')', [155]),
    155: State(DELIMS['paren_close_delim'], end=True),
    156: State('[', [157]),
    157: State(DELIMS['bracket_open_delim'], end=True),
    158: State(']', [159]),
    159: State(DELIMS['bracket_close_delim'], end=True),
    160: State(',', [161]),
    161: State(DELIMS['comma_delim'], end=True),

    # Comment blocks
    162: State('#', [163, 164]),
    163: State(DELIMS['stmt_delim'], end=True),
    164: State('#', [165]),
    165: State('#' or ATOMS['ascii'], [165, 166]), # TODO FIX
    166: State('#', [167]),
    167: State('#', [168]),
    168: State('#', [169]),
    169: State(DELIMS['stmt_delim'], end=True),
    
    # Identifier
    170: State(ATOMS['all_alphabet'] or ATOMS['under_alpha_num'], [170, 171]), # TODO FIX
    171: State(DELIMS['id_delim'], end=True),

    # Numeric Literals
    # This is one large, combined structure for integer and float parsing
    172: State(['-'], [173]),
    173: State(ATOMS['all_num'], [174, 175, 211]),
    174: State(DELIMS['dtype_lit_delim'], end=True),
    175: State(ATOMS['all_num'], [176, 177, 211]),
    176: State(DELIMS['dtype_lit_delim'], end=True),
    177: State(ATOMS['all_num'], [178, 179, 211]),
    178: State(DELIMS['dtype_lit_delim'], end=True),
    179: State(ATOMS['all_num'], [180, 181, 211]),
    180: State(DELIMS['dtype_lit_delim'], end=True),
    181: State(ATOMS['all_num'], [182, 183, 211]),
    182: State(DELIMS['dtype_lit_delim'], end=True),
    183: State(ATOMS['all_num'], [184, 185, 211]),
    184: State(DELIMS['dtype_lit_delim'], end=True),
    185: State(ATOMS['all_num'], [186, 187, 211]),
    186: State(DELIMS['dtype_lit_delim'], end=True),
    187: State(ATOMS['all_num'], [188, 189, 211]),
    188: State(DELIMS['dtype_lit_delim'], end=True),

    189: State(ATOMS['all_num'], [190, 191]),
    190: State(DELIMS['dtype_lit_delim'], end=True),
    191: State(ATOMS['all_num'], [192, 193, 211]),
    192: State(DELIMS['dtype_lit_delim'], end=True),
    193: State(ATOMS['all_num'], [194, 195, 211]),
    194: State(DELIMS['dtype_lit_delim'], end=True),
    195: State(ATOMS['all_num'], [196, 197, 211]),
    196: State(DELIMS['dtype_lit_delim'], end=True),
    197: State(ATOMS['all_num'], [198, 199, 211]),
    198: State(DELIMS['dtype_lit_delim'], end=True),
    199: State(ATOMS['all_num'], [200, 201, 211]),
    200: State(DELIMS['dtype_lit_delim'], end=True),
    201: State(ATOMS['all_num'], [202, 203, 211]),
    202: State(DELIMS['dtype_lit_delim'], end=True),
    203: State(ATOMS['all_num'], [204, 205, 211]),
    204: State(DELIMS['dtype_lit_delim'], end=True),
    205: State(ATOMS['all_num'], [206, 207, 211]),
    206: State(DELIMS['dtype_lit_delim'], end=True),
    207: State(ATOMS['all_num'], [208, 209, 211]),
    208: State(DELIMS['dtype_lit_delim'], end=True),
    209: State(ATOMS['all_num'], [210, 211]),
    210: State(DELIMS['dtype_lit_delim'], end=True),

    211: State('.', [212]),
    212: State(ATOMS['all_num'], [213, 214]),
    213: State(DELIMS['dtype_lit_delim'], end=True),
    214: State(ATOMS['all_num'], [215, 216]),
    215: State(DELIMS['dtype_lit_delim'], end=True),
    216: State(ATOMS['all_num'], [217, 218]),
    217: State(DELIMS['dtype_lit_delim'], end=True),
    218: State(ATOMS['all_num'], [219, 220]),
    219: State(DELIMS['dtype_lit_delim'], end=True),
    220: State(ATOMS['all_num'], [221, 222]),
    221: State(DELIMS['dtype_lit_delim'], end=True),
    222: State(ATOMS['all_num'], [223]),
    223: State(DELIMS['dtype_lit_delim'], end=True),

    # Character Literal
    224: State("'" or ATOMS[ascii], [224, 225]), # TODO FIX
    225: State("'", [226]),
    226: State(DELIMS['stmt_delim'], end=True),
}